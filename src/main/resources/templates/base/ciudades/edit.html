<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="plantillas/plantilla_cuerpo :: head">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
<script th:inline="javascript">
	var real_data = /*[[${departamentos}]]*/'noValue';
    $(document).ready(function() {
        $("#nameInput").autocomplete({
            minLength : 1,
            source : real_data,
            select : function(e, ui) {
                $("#nameOutput").text('You have selected : ' + ui.item.value);
                return ui.item.value;
            }
        })
    });
</script>
</head>
<meta charset="utf-8">
<body>
	<div th:replace="plantillas/plantilla_cuerpo :: sidebar"></div>
	<div th:insert="plantillas/plantilla_cuerpo :: main-panel (modulo=${modulo})"></div>

	<div class="main-panel">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12">
					<div class="panel">
						<div class="panel-header panel-header-info" style="background-color: #00BCD4">
							<div th:insert="plantillas/plantilla_cuerpo :: titulo-cuerpo (titulo_cuerpo=${titulo_cuerpo})"></div>
						</div>
					</div>
					<div class="container">
						<div class="row">
							<div class="col-md-8">
								<div class="card">
									<div class="card-body">
										<form th:action="@{/base/ciudades/{id}(id=*{id})}" th:method="put" th:object="${ciudad}">
											<input id="paisIdEdit" name="paisIdEdit" type="hidden" th:value="${ciudad.departamento.pais.id}">
											<input id="departamentoIdEdit" name="departamentoIdEdit" type="hidden" th:value="${ciudad.departamento.id}">
											<div class="row">
												<div class="col-md-12">
													<div class="form-group">
														<label class="bmd-label-floating">#Id</label>
														<input class="form-control" readonly type="number" th:field="*{id}" />
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-md-12">
													<div class="form-group">
														<label class="bmd-label-floating">Pais</label>
														<select id="listaPaisesEdit" name="listaPaisesEdit" class="form-control">
        													<!-- Las opciones se cargan dinamicamente desde JQuery -->
    													</select>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-md-12">
													<div class="form-group">
														<label class="bmd-label-floating">Departamento</label>
														<select id="listaDepartamentosEdit" name="departamento" class="form-control">
        													<!-- Las opciones se cargan dinamicamente desde JQuery -->
    													</select>
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-md-12">
													<div class="form-group">
														<label class="bmd-label-floating">Ciudad</label>
														<input class="form-control" type="text" th:field="*{nombre}" />
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-md-12">
													<div class="form-group">
														<label class="control-label">Activo</label> 
														<input class="form-control" type="checkbox" th:field="*{activo}" />
													</div>
												</div>
											</div>
											<div class="row">
												<div class="col-md-12">
													<div class="form-group">
														<label>Acerca de</label>
														<div class="form-group">
															<label class="bmd-label-floating">
																Registro de Ciudades necesario para la tabla de Ciudades.
															</label>
														</div>
													</div>
												</div>
											</div>
											<div class="pull-right">
												<button class="btn btn-default" type="submit">
													<span class="icon text-white-50"><i class="fas fa-save"></i></span>
													<span class="text"> Guardar</span>
												</button>
												<a class="btn btn-link" href="/base/ciudades">Volver</a>
											</div>
											<div class="clearfix"></div>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- <footer th:replace="plantillas/plantilla_cuerpo :: footer"></footer> -->
	
	<script>
		// The host name and protocol
	 	var host = window.location.protocol + "//" + window.location.host; //http://localhost:8090
	 	
		$(document).ready(function() {
			
			//Al cargar la vista de Edicion, inicializar los select-option para Paises y Departamentos
			function initializePaisesDepartamentosSelects() {
				var paisId;
				var departamentoId;
				paisId = $('input#paisIdEdit').val();
				departamentoId = $('input#departamentoIdEdit').val();
				
	  			$.getJSON(host+"/base/ciudades/paisesEdit", {
						paisId : paisId,
						ajax : 'true'
					}, function(data) {
						var html = '<option value="">--Seleccione Pais--</option>';
						var len = data.length;
						for ( var i = 0; i < len; i++) {
							if(data[i].id == paisId) {
								html += '<option value="' + data[i].id + '" selected>' + data[i].nombre + '</option>';
							} else {
								html += '<option value="' + data[i].id + '">' + data[i].nombre + '</option>';
							}
						}
						$('#listaPaisesEdit').html(html);
					}
				);
				
				$.getJSON(host+"/base/ciudades/departamentosPais", {
						paisId : paisId,
						ajax : 'true'
					}, function(data) {
						var html = '<option value="">--Seleccione Departamento--</option>';
						var len = data.length;
						for ( var i = 0; i < len; i++) {
							if(data[i].id == departamentoId) {
								html += '<option value="' + data[i].id + '" selected>' + data[i].nombre + '</option>';
							} else {
								html += '<option value="' + data[i].id + '">' + data[i].nombre + '</option>';
							}
						}
						$('#listaDepartamentosEdit').html(html);
					}
				);
			}
			
			initializePaisesDepartamentosSelects();
			
			
			//Carga la lista de Departamentos filtrado por Pais
	        $('#listaPaisesEdit').change(function() {
				$.getJSON(host+"/base/ciudades/departamentosPais", {
						paisId : $(this).val(),
						ajax : 'true'
					}, function(data) {
						var html = '<option value="">--Seleccione Departamento--</option>';
						var len = data.length;
						for ( var i = 0; i < len; i++) {
							html += '<option value="' + data[i].id + '">' + data[i].nombre + '</option>';
						}
					
						$('#listaDepartamentosEdit').html(html);
					}
				);
			});
			
	    });
	</script>
</body>
</html>
